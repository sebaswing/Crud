{"ast":null,"code":"import { Subscription } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/vacunas.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\n\nfunction ListaVacunasComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"div\", 2)(2, \"h5\", 10);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 5)(5, \"p\", 11);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 11);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const vacuna_r6 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.nombreVacunasEnum[vacuna_r6.id_vacuna]);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Fecha de aplicaci\\u00F3n: \", vacuna_r6.fecha_aplicacion, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Dosis: \", vacuna_r6.dosis, \"\");\n  }\n}\n\nfunction ListaVacunasComponent_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function ListaVacunasComponent_button_9_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.solicitarTurnoAmarilla());\n    });\n    i0.ɵɵtext(1, \" Solicitar Turno \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListaVacunasComponent_p_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \" fecha a confirmar \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListaVacunasComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"div\", 2)(2, \"h5\", 10);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 5)(5, \"p\", 11);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 11);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const vacuna_r9 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r3.nombreVacunasEnum[vacuna_r9.id_vacuna]);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Fecha de aplicaci\\u00F3n: \", vacuna_r9.fecha_aplicacion, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Dosis: \", vacuna_r9.dosis, \"\");\n  }\n}\n\nfunction ListaVacunasComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"div\", 2)(2, \"h5\", 10);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 5)(5, \"p\", 11);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 11);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const vacuna_r10 = ctx.$implicit;\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r4.nombreVacunasEnum[vacuna_r10.id_vacuna]);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Fecha de aplicaci\\u00F3n: \", vacuna_r10.fecha_aplicacion, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Dosis: \", vacuna_r10.dosis, \"\");\n  }\n}\n\nfunction ListaVacunasComponent_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"div\", 2)(2, \"h5\", 10);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 5)(5, \"p\", 11);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 11);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const vacuna_r11 = ctx.$implicit;\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r5.nombreVacunasEnum[vacuna_r11.id_vacuna]);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Fecha de aplicaci\\u00F3n: \", vacuna_r11.fecha_aplicacion, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Dosis: \", vacuna_r11.dosis, \"\");\n  }\n}\n\nvar nombreVacuna = /*#__PURE__*/(() => {\n  (function (nombreVacuna) {\n    nombreVacuna[nombreVacuna[\"Gripe\"] = 1] = \"Gripe\";\n    nombreVacuna[nombreVacuna[\"Covid\"] = 2] = \"Covid\";\n    nombreVacuna[nombreVacuna[\"Fiebre Amarilla\"] = 3] = \"Fiebre Amarilla\";\n  })(nombreVacuna || (nombreVacuna = {}));\n\n  return nombreVacuna;\n})();\n;\nexport let ListaVacunasComponent = /*#__PURE__*/(() => {\n  class ListaVacunasComponent {\n    constructor(vacunaService, route) {\n      this.vacunaService = vacunaService;\n      this.route = route;\n      this.nombreVacunasEnum = nombreVacuna;\n      this.mostrarBotonAmarilla = false;\n      this.mostrarCartelEsperando = false;\n      this.suscriptions = new Subscription();\n    }\n\n    ngOnInit() {\n      const id = Number(localStorage.getItem('idPaciente')) || 0;\n      this.suscriptions.add(this.vacunaService.obtenerVacunas(id).subscribe(vac => {\n        this.vacunas = vac;\n        this.cargarListasVacunas();\n        this.mostrarBotonAmarilla = this.puedoSolicitarAmarilla();\n        this.mostrarCartelEsperando = this.puedoMostrarCartelEsperando();\n      }));\n    }\n\n    cargarListasVacunas() {\n      this.gripe = this.vacunas.filter(vacuna => vacuna.id_vacuna === 1 && !this.compararFechas(vacuna));\n      this.covid = this.vacunas.filter(vacuna => vacuna.id_vacuna === 2 && !this.compararFechas(vacuna));\n      this.gripeAmarilla = this.vacunas.filter(vacuna => vacuna.id_vacuna === 3 && !this.compararFechas(vacuna) && this.fechaValida(vacuna));\n      this.vacunasPasadas = this.vacunas.filter(vacuna => this.compararFechas(vacuna) && this.fechaValida(vacuna));\n    }\n\n    puedoSolicitarAmarilla() {\n      const vacunasAmarilla = this.vacunas.filter(vacuna => vacuna.id_vacuna === 3);\n      const noSeVacuno = vacunasAmarilla.length === 0;\n      const noSolicitoTurno = vacunasAmarilla.filter(vacuna => !this.compararFechas(vacuna)).length === 0;\n      return noSeVacuno && noSolicitoTurno && this.edadValidaAmarilla();\n    }\n\n    puedoMostrarCartelEsperando() {\n      const vacunasAmarilla = this.vacunas.filter(vacuna => vacuna.id_vacuna === 3);\n      return !this.mostrarBotonAmarilla && vacunasAmarilla.length > 0 && !this.fechaValida(vacunasAmarilla[0]);\n    }\n\n    edadValidaAmarilla() {\n      const edad = Number(localStorage.getItem('edad'));\n      return edad < 60;\n    }\n\n    compararFechas(vac) {\n      const fechaHoy = new Date(Date.now());\n      const fechaTurno = new Date(vac.fecha_aplicacion);\n      return fechaTurno.getTime() < fechaHoy.getTime();\n    }\n\n    fechaValida(vac) {\n      let fechaVacuna = new Date(vac.fecha_aplicacion).getUTCFullYear();\n      return fechaVacuna !== 1900;\n    }\n\n    solicitarTurnoAmarilla() {\n      const fiebre = {};\n      fiebre.id_usuario = Number(localStorage.getItem('idPaciente'));\n      fiebre.id_vacuna = 3;\n      fiebre.dosis = 1;\n      fiebre.fecha_aplicacion = new Date(\"1900-01-01\");\n      fiebre.observacion = '';\n      this.suscriptions.add(this.vacunaService.createVacuna(fiebre).subscribe({\n        next: () => this.route.navigate(['refresh'])\n      }));\n    }\n\n    ngOnDestroy() {\n      this.suscriptions.unsubscribe();\n    }\n\n  }\n\n  ListaVacunasComponent.ɵfac = function ListaVacunasComponent_Factory(t) {\n    return new (t || ListaVacunasComponent)(i0.ɵɵdirectiveInject(i1.VacunasService), i0.ɵɵdirectiveInject(i2.Router));\n  };\n\n  ListaVacunasComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ListaVacunasComponent,\n    selectors: [[\"app-lista-vacunas\"]],\n    decls: 35,\n    vars: 6,\n    consts: [[1, \"container\"], [1, \"card\", \"card-list\"], [1, \"card-header\"], [1, \"row\"], [1, \"col-md-6\"], [1, \"card-body\"], [\"class\", \"card\", \"style\", \" width: 21Rem;margin: 10px;display: inline-block;\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"btn btn-outline-warning\", 3, \"click\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"card\", 2, \"width\", \"21Rem\", \"margin\", \"10px\", \"display\", \"inline-block\"], [1, \"card-title\"], [1, \"card-text\"], [1, \"btn\", \"btn-outline-warning\", 3, \"click\"]],\n    template: function ListaVacunasComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h3\");\n        i0.ɵɵtext(4, \"Turno gripe Amarilla\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"div\", 3);\n        i0.ɵɵelement(6, \"div\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 5);\n        i0.ɵɵtemplate(8, ListaVacunasComponent_div_8_Template, 9, 3, \"div\", 6);\n        i0.ɵɵtemplate(9, ListaVacunasComponent_button_9_Template, 2, 0, \"button\", 7);\n        i0.ɵɵtemplate(10, ListaVacunasComponent_p_10_Template, 2, 0, \"p\", 8);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(11, \"div\", 1)(12, \"div\", 2)(13, \"h3\");\n        i0.ɵɵtext(14, \"Turnos gripe\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(15, \"div\", 3);\n        i0.ɵɵelement(16, \"div\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"div\", 5);\n        i0.ɵɵtemplate(18, ListaVacunasComponent_div_18_Template, 9, 3, \"div\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(19, \"div\", 1)(20, \"div\", 2)(21, \"h3\");\n        i0.ɵɵtext(22, \"Turnos Covid\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(23, \"div\", 3);\n        i0.ɵɵelement(24, \"div\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"div\", 5);\n        i0.ɵɵtemplate(26, ListaVacunasComponent_div_26_Template, 9, 3, \"div\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(27, \"div\", 1)(28, \"div\", 2)(29, \"h3\");\n        i0.ɵɵtext(30, \"Historial Vacunas\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(31, \"div\", 3);\n        i0.ɵɵelement(32, \"div\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"div\", 5);\n        i0.ɵɵtemplate(34, ListaVacunasComponent_div_34_Template, 9, 3, \"div\", 6);\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", ctx.gripeAmarilla);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.mostrarBotonAmarilla);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.mostrarCartelEsperando);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", ctx.gripe);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", ctx.covid);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngForOf\", ctx.vacunasPasadas);\n      }\n    },\n    dependencies: [i3.NgForOf, i3.NgIf],\n    styles: [\".container[_ngcontent-%COMP%]{padding:50px 0}.card-list[_ngcontent-%COMP%]{margin-bottom:30px}\"]\n  });\n  return ListaVacunasComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}